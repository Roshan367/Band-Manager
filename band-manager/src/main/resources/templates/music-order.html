<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Music Order Details</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<body class="font-monospace">
<div th:replace="~{fragments/headerForm.html :: header}"></div>

<div class="container mt-5">
  <h1 class="text-center">Music Order Details</h1>
  <div th:if="${musicOrder==null}">
    <p>Error: Music Order not found!</p>
    <a class="btn btn-primary"
       th:if="${musicOrder.child != null}"
       th:href="@{/child/{childId}/music(childId=${musicOrder.child.id})}">
      Back to Music
    </a>

    <a class="btn btn-primary"
       th:unless="${musicOrder.child != null}"
       href="/music">
      Back to Music
    </a>
  </div>

  <div th:unless="${musicOrder==null}">
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
      <span th:text="${successMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${errorMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Music Order Information</h5>
        <p><strong>Music Order Owner Name: </strong><span th:text="${musicOrder.owner.fullName}"></span> </p>
        <p><strong>Music Order Date: </strong><span th:text="${musicOrder.date}"></span> </p>
        <div class="d-flex justify-content-between mt-4">

          <button type="button" id="deleteMusicOrderButton" class="btn btn-danger"
                  th:data-id="${musicOrder.id}"
                  th:if="${musicOrder.status != 'FULFILLED' && musicOrder.status != 'READY' && musicOrder.child == null}">
            Delete Music Order</button>

          <button type="button" id="deleteChildMusicOrderButton" class="btn btn-danger"
                  th:data-id="${musicOrder.id} + '_' + ${musicOrder.child.id}"
                  th:if="${musicOrder.status != 'FULFILLED' && musicOrder.status != 'READY' && musicOrder.child != null}">
            Delete Music Order</button>

          <a class="btn btn-primary"
             th:href="@{/music-order/{musicOrderId}/new(musicOrderId=${musicOrder.id})}"
             th:if="${musicOrder.status != 'FULFILLED' && musicOrder.status != 'READY' }">Add Music Part</a>

          <a class="btn btn-primary"
             th:if="${musicOrder.child != null}"
             th:href="@{/child/{childId}/music(childId=${musicOrder.child.id})}">
            Back to Music
          </a>

          <a class="btn btn-primary"
             th:unless="${musicOrder.child != null}"
             href="/music">
            Back to Music
          </a>
          <!-- Button to fulfill the order -->
          <form th:action="@{/music-order/{musicOrderId}/ready(musicOrderId=${musicOrder.id})}"
                th:method="post" th:if="${musicOrder.status != 'FULFILLED' && musicOrder.status != 'READY' }">
            <input type="hidden" name="musicOrderId" th:value="${musicOrder.id}" />
            <button type="submit" class="btn btn-success">Ready Music Order</button>
          </form>
        </div>
      <h1>Music Part List</h1>
      <table class="table table-bordered table-stripped">
        <thead>
        <tr>
          <th>#</th>
          <th>Part Name</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="musicPart : ${musicParts}">
          <td th:text="${musicPart.id}"></td>
          <td th:text="${musicPart.partName}"></td>
        </tr>
        </tbody>
      </table>

    </div>

  </div>

</div>
<script th:src="@{/js/musicOrder.js}"></script>
</div>
</body>
</html>
